---
layout: post
title:  "Java内存模型FAQ（五）旧的内存模型有什么问题？"
date:   2019-07-17 20:14:54
categories: java
tags: java 内存模型
---

* content
{:toc}

# Java内存模型FAQ（五）旧的内存模型有什么问题？
旧的内存模型中有几个严重的问题。这些问题很难理解，因此被广泛的违背。例如，旧的存储模型在许多情况下，不允许`JVM`发生各种重排序行为。旧的内存模型中让人产生困惑的因素造就了JSR-133规范的诞生。


例如，一个被广泛认可的概念就是，如果使用`final`字段，那么就没有必要在多个线程中使用同步来保证其他线程能够看到这个字段的值。尽管这是一个合理的假设和明显的行为，也是我们所期待的结果。实际上，在旧的内存模型中，我们想让程序正确运行起来却是不行的。在旧的内存模型中，`final`字段并没有同其他字段进行区别对待——这意味着同步是保证所有线程看到一个在构造方法中初始化的final字段的唯一方法。结果——如果没有正确同步的话，对一个线程来说，它可能看到一个字段的默认值，然后在稍后的时间里，又能够看到构造方法中设置的值。这意味着，一些不可变的对象，例如`String`，能够改变它们值——这实在很让人郁闷。

旧的内存模型允许`volatile`变量的写操作和非`volaitle`变量的读写操作一起进行重排序，这和大多数的开发人员对于`volatile`变量的直观感受是不一致的，因此会造成迷惑。

最后，我们将看到的是，程序员对于程序没有被正确同步的情况下将会发生什么的直观感受通常是错误的。`JSR-133`的目的之一就是要引起这方面的注意。
